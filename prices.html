<!DOCTYPE html>
<html>
<body>

<p>Cloud instance prices</p>

<link href="css/tabulator.min.css" rel="stylesheet">
<script type="text/javascript" src="js/tabulator.min.js"></script>
<div id="example-table"></div>

<script>
  //custom max min header filter
  var minMaxFilterEditor = function(cell, onRendered, success, cancel, editorParams){

      var end;

      var container = document.createElement("span");

      //create and style inputs
      var start = document.createElement("input");
      start.setAttribute("type", "number");
      start.setAttribute("placeholder", "Min");
      start.setAttribute("min", 0);
      start.setAttribute("max", 100);
      start.style.padding = "4px";
      start.style.width = "50%";
      start.style.boxSizing = "border-box";

      start.value = cell.getValue();

      function buildValues(){
          success({
              start:start.value,
              end:end.value,
          });
      }

      function keypress(e){
          if(e.keyCode == 13){
              buildValues();
          }

          if(e.keyCode == 27){
              cancel();
          }
      }

      end = start.cloneNode();

      start.addEventListener("change", buildValues);
      start.addEventListener("blur", buildValues);
      start.addEventListener("keydown", keypress);

      end.addEventListener("change", buildValues);
      end.addEventListener("blur", buildValues);
      end.addEventListener("keydown", keypress);


      container.appendChild(start);
      container.appendChild(end);

      return container;
   }

  //custom max min filter function
  function minMaxFilterFunction(headerValue, rowValue, rowData, filterParams){
      //headerValue - the value of the header filter element
      //rowValue - the value of the column in this row
      //rowData - the data for the row being filtered
      //filterParams - params object passed to the headerFilterFuncParams property

          if(rowValue){
              if(headerValue.start != ""){
                  if(headerValue.end != ""){
                      return rowValue >= headerValue.start && rowValue <= headerValue.end;
                  }else{
                      return rowValue >= headerValue.start;
                  }
              }else{
                  if(headerValue.end != ""){
                      return rowValue <= headerValue.end;
                  }
              }
          }

      return false; //must return a boolean, true if it passes the filter.
  }

  //Build Tabulator
  var table = new Tabulator("#example-table", {
      height:"311px",
      layout:"fitDataFill",
      placeholder:"No Data Set",

      columns:[
          {title:"Provider", field:"provider", editor:"select", editorParams:{values:{"aws":"Amazon"}}, headerFilter:true, headerFilterParams:{values:{"aws":"Amazon", "":""}}},
          {title:"Instance", field:"instanceType", sorter:"string", headerFilter:"input"},
          {title:"vCPUs", field:"vcpu", sorter:"number", headerFilter:minMaxFilterEditor, headerFilterFunc:minMaxFilterFunction},
          {title:"RAM[GiB]", field:"memory", sorter:"number", headerFilter:minMaxFilterEditor, headerFilterFunc:minMaxFilterFunction},

          {title:"Arch", field:"cpu_arch", editor:"select", editorParams:{values:{"x86_64":"x86_64", "arm64":"arm64"}}, headerFilter:true, headerFilterParams:{values:{"x86_64":"x86_64", "arm64":"arm64", "":""}}},
          {title:"Freq", field:"clockSpeed", sorter:"string"},
          {title:"Location", field:"location", editor:"select", editorParams:{values:{"US East (N. Virginia)":"US East (N. Virginia)","US West (Oregon)":"US West (Oregon)","EU (Ireland)":"EU (Ireland)","US East (Ohio)":"US East (Ohio)","EU (Stockholm)":"EU (Stockholm)","Canada (Central)":"Canada (Central)","Asia Pacific (Sydney)":"Asia Pacific (Sydney)","Asia Pacific (Seoul)":"Asia Pacific (Seoul)","US West (N. California)":"US West (N. California)","EU (Paris)":"EU (Paris)","AWS GovCloud (US)":"AWS GovCloud (US)","Asia Pacific (Singapore)":"Asia Pacific (Singapore)","Asia Pacific (Mumbai)":"Asia Pacific (Mumbai)","Asia Pacific (Tokyo)":"Asia Pacific (Tokyo)","South America (Sao Paulo)":"South America (Sao Paulo)","EU (Frankfurt)":"EU (Frankfurt)","EU (London)":"EU (London)","Asia Pacific (Osaka-Local)":"Asia Pacific (Osaka-Local)","AWS GovCloud (US-East)":"AWS GovCloud (US-East)"}}, headerFilter:true, headerFilterParams:{values:{"US East (N. Virginia)":"US East (N. Virginia)","US West (Oregon)":"US West (Oregon)","EU (Ireland)":"EU (Ireland)","US East (Ohio)":"US East (Ohio)","EU (Stockholm)":"EU (Stockholm)","Canada (Central)":"Canada (Central)","Asia Pacific (Sydney)":"Asia Pacific (Sydney)","Asia Pacific (Seoul)":"Asia Pacific (Seoul)","US West (N. California)":"US West (N. California)","EU (Paris)":"EU (Paris)","AWS GovCloud (US)":"AWS GovCloud (US)","Asia Pacific (Singapore)":"Asia Pacific (Singapore)","Asia Pacific (Mumbai)":"Asia Pacific (Mumbai)","Asia Pacific (Tokyo)":"Asia Pacific (Tokyo)","South America (Sao Paulo)":"South America (Sao Paulo)","EU (Frankfurt)":"EU (Frankfurt)","EU (London)":"EU (London)","Asia Pacific (Osaka-Local)":"Asia Pacific (Osaka-Local)","AWS GovCloud (US-East)":"AWS GovCloud (US-East)", "":""}}},
          {title:"Family", field:"instanceFamily", editor:"select", editorParams:{values:{"General purpose":"General purpose","Compute optimized":"Compute optimized","Storage optimized":"Storage optimized","GPU instance":"GPU instance","Memory optimized":"Memory optimized","FPGA Instances":"FPGA Instances","Micro instances":"Micro instances"}}, headerFilter:true, headerFilterParams:{values:{"General purpose":"General purpose","Compute optimized":"Compute optimized","Storage optimized":"Storage optimized","GPU instance":"GPU instance","Memory optimized":"Memory optimized","FPGA Instances":"FPGA Instances","Micro instances":"Micro instances", "":""}}},
          {title:"Current gen", field:"currentGeneration", editor:"select", editorParams:{values:{"Yes":"Yes", "No":"No"}}, headerFilter:true, headerFilterParams:{values:{"Yes":"Yes", "No":"No", "":""}}},
          {title:"EBS tput", field:"dedicatedEbsThroughput", sorter:"string"},
          {title:"Processor", field:"physicalProcessor", sorter:"string"},
          {title:"Region", field:"region", sorter:"string"},
          {title:"Spot", field:"spot", sorter:"string"},
          {title:"price", field:"price", sorter:"number", headerFilter:minMaxFilterEditor, headerFilterFunc:minMaxFilterFunction},

      ],
  });

  //trigger AJAX load on "Load Data via AJAX" button click
  table.setData("https://cloudperf-data.s3-us-west-2.amazonaws.com/prices.json");
</script>
</body>
</html>
